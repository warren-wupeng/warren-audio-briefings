<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<meta name="theme-color" content="#f8f5f1">
<title>沈知意 | Zoey</title>
<link rel="manifest" href="manifest.json">
<style>
  *{margin:0;padding:0;box-sizing:border-box}
  :root{
    --bg:#f8f5f1;
    --surface:#ffffff;
    --surface2:#f0ebe4;
    --text:#1a1a2e;
    --text2:#6b7280;
    --text3:#9ca3af;
    --accent:#7c5ce7;
    --accent-light:#a78bfa;
    --accent-bg:rgba(124,92,231,.08);
    --green:#10b981;
    --green-bg:rgba(16,185,129,.08);
    --orange:#f59e0b;
    --orange-bg:rgba(245,158,11,.08);
    --radius:20px;
    --radius-sm:14px;
    --shadow:0 2px 12px rgba(0,0,0,.06);
    --shadow-lg:0 8px 30px rgba(0,0,0,.08);
  }
  body{
    font-family:-apple-system,BlinkMacSystemFont,'PingFang SC','Helvetica Neue',sans-serif;
    background:var(--bg);color:var(--text);
    min-height:100vh;min-height:100dvh;
    -webkit-tap-highlight-color:transparent;
    overflow-x:hidden;
    line-height:1.6;
  }

  /* Hero */
  .hero{
    text-align:center;
    padding:40px 20px 24px;
    position:relative;
    overflow:hidden;
  }
  .hero::before{
    content:'';position:absolute;top:-60px;left:50%;transform:translateX(-50%);
    width:300px;height:300px;
    background:radial-gradient(circle,rgba(124,92,231,.12) 0%,transparent 70%);
    pointer-events:none;
  }
  .avatar-wrap{
    width:120px;height:120px;margin:0 auto 16px;
    border-radius:50%;overflow:hidden;
    box-shadow:0 4px 20px rgba(124,92,231,.2);
    border:3px solid var(--surface);
    position:relative;
  }
  .avatar-wrap img{width:100%;height:100%;object-fit:cover}
  .hero h1{
    font-size:1.4rem;font-weight:700;
    letter-spacing:.02em;margin-bottom:4px;
  }
  .hero .subtitle{
    color:var(--text2);font-size:.85rem;
    margin-bottom:12px;
  }
  .hero .bio{
    color:var(--text2);font-size:.8rem;
    max-width:300px;margin:0 auto;
    line-height:1.5;
  }
  .hero .tag{
    display:inline-block;
    padding:4px 12px;border-radius:20px;
    font-size:.75rem;font-weight:500;
    background:var(--accent-bg);color:var(--accent);
    margin-top:10px;
  }

  /* Container */
  .container{max-width:480px;margin:0 auto;padding:0 16px 140px}

  /* Tabs */
  .tabs{
    display:flex;gap:8px;margin-bottom:20px;
    padding:0 4px;
  }
  .tabs button{
    flex:1;padding:10px 0;border-radius:12px;border:none;
    background:var(--surface);color:var(--text2);
    font-size:.85rem;font-weight:500;cursor:pointer;
    transition:all .25s;box-shadow:var(--shadow);
  }
  .tabs button.active{
    background:var(--accent);color:#fff;
    box-shadow:0 4px 14px rgba(124,92,231,.3);
  }

  /* Section header */
  .section-label{
    font-size:.75rem;font-weight:600;color:var(--text3);
    text-transform:uppercase;letter-spacing:.08em;
    padding:16px 4px 10px;
  }

  /* Cards */
  .card{
    background:var(--surface);border-radius:var(--radius);
    padding:18px;margin-bottom:10px;cursor:pointer;
    transition:all .2s;box-shadow:var(--shadow);
    border:2px solid transparent;position:relative;
    display:flex;align-items:center;gap:14px;
  }
  .card:active{transform:scale(.985)}
  .card.playing{
    border-color:var(--accent);
    box-shadow:0 4px 20px rgba(124,92,231,.15);
  }
  .card-icon{
    flex-shrink:0;width:48px;height:48px;border-radius:14px;
    display:flex;align-items:center;justify-content:center;
    font-size:1.2rem;
  }
  .card-icon.briefing{background:var(--green-bg);color:var(--green)}
  .card-icon.interview{background:var(--accent-bg);color:var(--accent)}
  .card-body{flex:1;min-width:0}
  .card .title{
    font-size:.95rem;font-weight:600;
    white-space:nowrap;overflow:hidden;text-overflow:ellipsis;
    margin-bottom:2px;
  }
  .card .meta{
    color:var(--text3);font-size:.78rem;
    display:flex;align-items:center;gap:8px;
  }
  .card .meta svg{flex-shrink:0}
  .card .play-hint{
    flex-shrink:0;width:36px;height:36px;
    border-radius:50%;background:var(--accent-bg);
    display:flex;align-items:center;justify-content:center;
    color:var(--accent);transition:all .2s;
  }
  .card.playing .play-hint{
    background:var(--accent);color:#fff;
  }

  /* Player bar */
  .player-bar{
    position:fixed;bottom:0;left:0;right:0;
    background:rgba(255,255,255,.92);
    backdrop-filter:blur(24px);-webkit-backdrop-filter:blur(24px);
    border-top:1px solid rgba(0,0,0,.06);
    padding:14px 16px calc(14px + env(safe-area-inset-bottom));
    transform:translateY(100%);transition:transform .35s cubic-bezier(.4,0,.2,1);
    z-index:100;
  }
  .player-bar.visible{transform:translateY(0)}

  .player-info{
    display:flex;align-items:center;gap:12px;margin-bottom:12px;
  }
  .player-avatar{
    width:40px;height:40px;border-radius:12px;overflow:hidden;flex-shrink:0;
  }
  .player-avatar img{width:100%;height:100%;object-fit:cover}
  .player-title{
    flex:1;min-width:0;
  }
  .player-title .now-playing{
    font-size:.85rem;font-weight:600;color:var(--text);
    white-space:nowrap;overflow:hidden;text-overflow:ellipsis;
  }
  .player-title .now-meta{
    font-size:.72rem;color:var(--text3);
  }

  .progress-wrap{
    width:100%;height:24px;display:flex;align-items:center;
    cursor:pointer;touch-action:none;margin-bottom:4px;
  }
  .progress-bg{
    width:100%;height:3px;background:var(--surface2);border-radius:2px;
    position:relative;overflow:visible;
  }
  .progress-fill{
    height:100%;background:linear-gradient(90deg,var(--accent),var(--accent-light));
    border-radius:2px;width:0%;position:relative;transition:none;
  }
  .progress-fill::after{
    content:'';position:absolute;right:-7px;top:50%;transform:translateY(-50%);
    width:14px;height:14px;background:var(--accent);border-radius:50%;
    box-shadow:0 0 0 4px rgba(124,92,231,.15);
  }
  .time-row{
    display:flex;justify-content:space-between;
    font-size:.7rem;color:var(--text3);margin-bottom:10px;
  }

  .controls{display:flex;align-items:center;justify-content:center;gap:16px}
  .ctrl-btn{
    background:none;border:none;color:var(--text2);cursor:pointer;
    width:44px;height:44px;display:flex;align-items:center;justify-content:center;
    border-radius:50%;transition:all .15s;
  }
  .ctrl-btn:active{background:var(--surface2)}
  .ctrl-btn.play{
    width:56px;height:56px;
    background:var(--accent);color:#fff;
    border-radius:50%;
    box-shadow:0 4px 14px rgba(124,92,231,.3);
  }
  .ctrl-btn.play:active{background:var(--accent-light)}

  .speed-btn{
    font-size:.78rem;font-weight:700;min-width:44px;
    padding:6px 10px;background:var(--surface2);border:none;
    color:var(--text);border-radius:10px;cursor:pointer;
    text-align:center;
  }
  .speed-btn:active{background:var(--accent-bg);color:var(--accent)}

  /* Empty state */
  .empty{text-align:center;padding:48px 20px;color:var(--text3)}

  /* Loading */
  .loading{text-align:center;padding:40px;color:var(--text3)}
  @keyframes pulse{0%,100%{opacity:.4}50%{opacity:1}}
  .loading span{animation:pulse 1.5s infinite}

  @media(max-width:480px){
    .container{padding:0 12px 140px}
    .hero{padding:32px 16px 20px}
  }
</style>
</head>
<body>

<div class="hero">
  <div class="avatar-wrap">
    <img src="audio/zoey-avatar.png" alt="沈知意" />
  </div>
  <h1>沈知意</h1>
  <div class="subtitle">Warren 的首席 AI 助理</div>
  <div class="bio">每天为你整理工作进展、面试准备和团队动态</div>
  <div class="tag">内容由 AI 生成</div>
</div>

<div class="container">
  <div class="tabs" id="tabs"></div>
  <div id="list"><div class="loading"><span>Loading...</span></div></div>
</div>

<div class="player-bar" id="playerBar">
  <div class="player-info">
    <div class="player-avatar"><img src="audio/zoey-avatar.png" alt="" /></div>
    <div class="player-title">
      <div class="now-playing" id="nowPlaying">--</div>
      <div class="now-meta" id="nowMeta">Zoey</div>
    </div>
  </div>
  <div class="progress-wrap" id="progressWrap">
    <div class="progress-bg">
      <div class="progress-fill" id="progressFill"></div>
    </div>
  </div>
  <div class="time-row">
    <span id="timeCur">0:00</span>
    <span id="timeTotal">0:00</span>
  </div>
  <div class="controls">
    <button class="ctrl-btn" id="btnBack" title="Back 15s">
      <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M1 4v6h6"/><path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"/><text x="12" y="16" fill="currentColor" stroke="none" font-size="8" text-anchor="middle" font-weight="bold">15</text></svg>
    </button>
    <button class="ctrl-btn play" id="btnPlay" title="Play">
      <svg id="iconPlay" width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><polygon points="7,3 21,12 7,21"/></svg>
      <svg id="iconPause" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" style="display:none"><rect x="5" y="3" width="4" height="18" rx="1"/><rect x="15" y="3" width="4" height="18" rx="1"/></svg>
    </button>
    <button class="ctrl-btn" id="btnFwd" title="Forward 30s">
      <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M23 4v6h-6"/><path d="M20.49 15a9 9 0 1 1-2.13-9.36L23 10"/><text x="12" y="16" fill="currentColor" stroke="none" font-size="8" text-anchor="middle" font-weight="bold">30</text></svg>
    </button>
    <button class="speed-btn" id="btnSpeed">1.0x</button>
  </div>
</div>

<audio id="audio" preload="metadata"></audio>

<script>
(function(){
  const SPEEDS = [0.8, 1.0, 1.2, 1.5, 2.0];
  const AUDIO_BASE = 'audio/';
  const MANIFEST_URL = 'audio/manifest.json';

  const audio = document.getElementById('audio');
  const list = document.getElementById('list');
  const tabs = document.getElementById('tabs');
  const playerBar = document.getElementById('playerBar');
  const nowPlaying = document.getElementById('nowPlaying');
  const nowMeta = document.getElementById('nowMeta');
  const progressFill = document.getElementById('progressFill');
  const progressWrap = document.getElementById('progressWrap');
  const timeCur = document.getElementById('timeCur');
  const timeTotal = document.getElementById('timeTotal');
  const btnPlay = document.getElementById('btnPlay');
  const iconPlay = document.getElementById('iconPlay');
  const iconPause = document.getElementById('iconPause');
  const btnBack = document.getElementById('btnBack');
  const btnFwd = document.getElementById('btnFwd');
  const btnSpeed = document.getElementById('btnSpeed');

  let manifest = [];
  let categories = [];
  let currentCat = 'all';
  let currentIdx = -1;
  let speedIdx = 1;

  function fmt(s){
    if(!s||isNaN(s))return '0:00';
    const m=Math.floor(s/60), sec=Math.floor(s%60);
    return m+':'+(sec<10?'0':'')+sec;
  }

  const catLabels = {
    all:'全部',
    briefing:'每日简报',
    interview:'面试准备'
  };

  const catIcons = {
    briefing: '<svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>',
    interview: '<svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"/><path d="M19 10v2a7 7 0 0 1-14 0v-2"/><line x1="12" y1="19" x2="12" y2="23"/><line x1="8" y1="23" x2="16" y2="23"/></svg>'
  };

  async function init(){
    try{
      const r = await fetch(MANIFEST_URL + '?t=' + Date.now());
      if(!r.ok) throw new Error('No manifest');
      manifest = await r.json();
    }catch(e){
      manifest = [];
    }
    if(!manifest.length){
      list.innerHTML='<div class="empty"><p>暂无音频内容</p></div>';
      return;
    }
    // Sort: briefings first (newest), then interview
    manifest.sort((a,b) => {
      if(a.category === 'briefing' && b.category !== 'briefing') return -1;
      if(a.category !== 'briefing' && b.category === 'briefing') return 1;
      if(a.date && b.date) return b.date.localeCompare(a.date);
      return 0;
    });
    const catSet = new Set();
    manifest.forEach(a => catSet.add(a.category||'Other'));
    categories = ['all', ...catSet];
    renderTabs();
    renderList();
  }

  function renderTabs(){
    tabs.innerHTML = categories.map(c =>
      '<button class="'+(c===currentCat?'active':'')+'" data-cat="'+c+'">'+(catLabels[c]||c)+'</button>'
    ).join('');
    tabs.querySelectorAll('button').forEach(b => {
      b.onclick = () => {
        currentCat = b.dataset.cat;
        renderTabs();
        renderList();
      };
    });
  }

  function renderList(){
    const items = currentCat==='all' ? manifest :
      manifest.filter(a => (a.category||'Other')===currentCat);
    if(!items.length){
      list.innerHTML='<div class="empty"><p>该分类暂无内容</p></div>';
      return;
    }

    // Group by category
    const groups = {};
    items.forEach(a => {
      const cat = a.category || 'Other';
      if(!groups[cat]) groups[cat] = [];
      groups[cat].push(a);
    });

    let html = '';
    const order = ['briefing', 'interview', 'Other'];
    order.forEach(cat => {
      if(!groups[cat]) return;
      if(currentCat === 'all' && Object.keys(groups).length > 1){
        html += '<div class="section-label">'+(catLabels[cat]||cat)+'</div>';
      }
      groups[cat].forEach(a => {
        const idx = manifest.indexOf(a);
        const cat = a.category||'Other';
        const icon = catIcons[cat] || catIcons.briefing;
        html += '<div class="card '+(idx===currentIdx?'playing':'')+'" data-idx="'+idx+'">' +
          '<div class="card-icon '+cat+'">'+icon+'</div>' +
          '<div class="card-body">' +
            '<div class="title">'+a.title+'</div>' +
            '<div class="meta">' +
              '<span>'+(a.date||'')+'</span>' +
              (a.duration && a.duration!=='--' ? '<span>'+a.duration+'</span>' : '') +
            '</div>' +
          '</div>' +
          '<div class="play-hint">' +
            (idx===currentIdx && !audio.paused ?
              '<svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><rect x="5" y="3" width="4" height="18" rx="1"/><rect x="15" y="3" width="4" height="18" rx="1"/></svg>' :
              '<svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><polygon points="7,3 21,12 7,21"/></svg>'
            ) +
          '</div>' +
        '</div>';
      });
    });

    list.innerHTML = html;
    list.querySelectorAll('.card').forEach(card => {
      card.onclick = () => play(parseInt(card.dataset.idx));
    });
  }

  function play(idx){
    if(idx<0||idx>=manifest.length) return;
    currentIdx = idx;
    const a = manifest[idx];
    audio.src = AUDIO_BASE + a.file;
    audio.playbackRate = SPEEDS[speedIdx];
    audio.play().catch(()=>{});
    nowPlaying.textContent = a.title;
    nowMeta.textContent = (a.date||'') + ' · Zoey';
    playerBar.classList.add('visible');
    renderList();
  }

  btnPlay.onclick = () => {
    if(!audio.src) return;
    if(audio.paused) audio.play().catch(()=>{});
    else audio.pause();
  };
  btnBack.onclick = () => { audio.currentTime = Math.max(0, audio.currentTime - 15); };
  btnFwd.onclick = () => { audio.currentTime = Math.min(audio.duration||0, audio.currentTime + 30); };
  btnSpeed.onclick = () => {
    speedIdx = (speedIdx + 1) % SPEEDS.length;
    audio.playbackRate = SPEEDS[speedIdx];
    btnSpeed.textContent = SPEEDS[speedIdx] + 'x';
  };

  audio.addEventListener('play', () => {
    iconPlay.style.display='none'; iconPause.style.display='';
    renderList();
  });
  audio.addEventListener('pause', () => {
    iconPlay.style.display=''; iconPause.style.display='none';
    renderList();
  });
  audio.addEventListener('timeupdate', () => {
    if(!audio.duration) return;
    const pct = (audio.currentTime / audio.duration) * 100;
    progressFill.style.width = pct + '%';
    timeCur.textContent = fmt(audio.currentTime);
    timeTotal.textContent = fmt(audio.duration);
  });
  audio.addEventListener('ended', () => {
    if(currentIdx < manifest.length - 1) play(currentIdx + 1);
  });

  function seekFromEvent(e){
    const rect = progressWrap.getBoundingClientRect();
    const x = (e.touches ? e.touches[0].clientX : e.clientX) - rect.left;
    const pct = Math.max(0, Math.min(1, x / rect.width));
    audio.currentTime = pct * (audio.duration || 0);
  }
  progressWrap.addEventListener('click', seekFromEvent);
  let dragging = false;
  progressWrap.addEventListener('touchstart', (e) => { dragging = true; seekFromEvent(e); }, {passive:true});
  document.addEventListener('touchmove', (e) => { if(dragging) seekFromEvent(e); }, {passive:true});
  document.addEventListener('touchend', () => { dragging = false; });

  if('mediaSession' in navigator){
    audio.addEventListener('play', () => {
      const a = manifest[currentIdx];
      if(!a) return;
      navigator.mediaSession.metadata = new MediaMetadata({
        title: a.title,
        artist: '沈知意 | Zoey',
        album: catLabels[a.category] || 'Audio',
      });
    });
    navigator.mediaSession.setActionHandler('play', () => audio.play());
    navigator.mediaSession.setActionHandler('pause', () => audio.pause());
    navigator.mediaSession.setActionHandler('seekbackward', () => { audio.currentTime = Math.max(0, audio.currentTime - 15); });
    navigator.mediaSession.setActionHandler('seekforward', () => { audio.currentTime += 30; });
    navigator.mediaSession.setActionHandler('previoustrack', () => { if(currentIdx>0) play(currentIdx-1); });
    navigator.mediaSession.setActionHandler('nexttrack', () => { if(currentIdx<manifest.length-1) play(currentIdx+1); });
  }

  init();
})();
</script>
</body>
</html>
